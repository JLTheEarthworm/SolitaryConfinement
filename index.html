<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DBD Jack Wheel (Hidden Role)</title>
  <style>
    body {
      font-family: system-ui, Arial, sans-serif;
      margin: 24px;
      max-width: 900px;
    }
    h1 { margin-bottom: 8px; }
    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    textarea {
      width: 100%;
      min-height: 160px;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
    }
    button {
      padding: 10px 14px;
      cursor: pointer;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 14px;
      margin-top: 14px;
    }
    .muted { color: #666; }
    .big {
      font-size: 22px;
      font-weight: 700;
    }
    ul { margin: 8px 0 0; }
    .danger {
      color: #b00020;
      font-weight: 700;
    }
    .ok {
      color: #0b7a0b;
      font-weight: 700;
    }
    .pill {
      display: inline-block;
      padding: 4px 10px;
      border: 1px solid #ddd;
      border-radius: 999px;
      font-size: 12px;
    }
  </style>
</head>
<body>

<h1>DBD Jack Wheel (Hidden Role)</h1>
<p class="muted">
  Paste survivor names (one per line). Start the game to secretly assign the Jack.
  Execute survivors to check for the Jack.  
  <b>If only 2 survivors remain, the Jack wins automatically.</b>
</p>

<div class="card">
  <h2>1) Setup</h2>
  <textarea id="namesInput" placeholder="Enter survivor names, one per line..."></textarea>
  <div class="row" style="margin-top:10px;">
    <button id="startBtn">Start Game</button>
    <button id="resetBtn">Reset</button>
    <span id="status" class="pill">Not started</span>
  </div>
  <p class="muted" id="counts"></p>
</div>

<div class="card">
  <h2>2) Round</h2>
  <div class="row">
    <button id="spinBtn" disabled>Spin</button>
    <button id="executeBtn" disabled>Execute</button>
    <button id="spareBtn" disabled>Spare</button>
  </div>
  <p class="muted">Selected survivor:</p>
  <div id="selected" class="big">—</div>
  <p id="resultMsg"></p>
</div>

<div class="card">
  <h2>3) Remaining Survivors</h2>
  <ul id="remainingList"></ul>
</div>

<script>
  // ===== GAME STATE =====
  let survivors = [];
  let jackName = null;
  let selectedName = null;
  let gameOver = false;

  const el = (id) => document.getElementById(id);

  function pickRandom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function renderRemaining() {
    const ul = el("remainingList");
    ul.innerHTML = "";
    survivors.forEach(name => {
      const li = document.createElement("li");
      li.textContent = name;
      ul.appendChild(li);
    });
    el("counts").textContent = `Remaining: ${survivors.length}`;
  }

  function setButtons({ spin, execute, spare }) {
    el("spinBtn").disabled = !spin;
    el("executeBtn").disabled = !execute;
    el("spareBtn").disabled = !spare;
  }

  function setStatus(text) {
    el("status").textContent = text;
  }

  function clearRound() {
    selectedName = null;
    el("selected").textContent = "—";
  }

  // ===== SETUP =====
  el("startBtn").addEventListener("click", () => {
    const names = el("namesInput").value
      .split("\n")
      .map(n => n.trim())
      .filter(Boolean);

    if (names.length < 3) {
      alert("You need at least 3 survivors to start.");
      return;
    }

    survivors = [...names];
    jackName = pickRandom(survivors); // SECRET
    gameOver = false;

    clearRound();
    renderRemaining();
    setStatus("Game running (Jack hidden)");
    setButtons({ spin: true, execute: false, spare: false });

    // DEBUG ONLY (leave commented)
    // console.log("Jack is:", jackName);
  });

  el("resetBtn").addEventListener("click", () => {
    survivors = [];
    jackName = null;
    selectedName = null;
    gameOver = false;

    el("namesInput").value = "";
    el("remainingList").innerHTML = "";
    el("counts").textContent = "";
    el("resultMsg").textContent = "";
    el("selected").textContent = "—";

    setStatus("Not started");
    setButtons({ spin: false, execute: false, spare: false });
  });

  // ===== GAMEPLAY =====
  el("spinBtn").addEventListener("click", () => {
    if (gameOver || survivors.length === 0) return;

    selectedName = pickRandom(survivors);
    el("selected").textContent = selectedName;
    el("resultMsg").textContent = "";
    setButtons({ spin: true, execute: true, spare: true });
  });

  el("spareBtn").addEventListener("click", () => {
    if (gameOver || !selectedName) return;

    el("resultMsg").innerHTML = `<span class="ok">Spared.</span> Nothing happens.`;
    clearRound();
    setButtons({ spin: true, execute: false, spare: false });
  });

  el("executeBtn").addEventListener("click", () => {
    if (gameOver || !selectedName) return;

    // JACK EXECUTED
    if (selectedName === jackName) {
      gameOver = true;
      setStatus("Game over");
      el("resultMsg").innerHTML =
        `<span class="danger">JACK FOUND!</span><br>
         ${selectedName} was the Jack of Hearts.<br><br>
         <b>Survivors win.</b>`;
      setButtons({ spin: false, execute: false, spare: false });
      return;
    }

    // NOT JACK → REMOVE
    survivors = survivors.filter(n => n !== selectedName);
    renderRemaining();

    // ✅ NEW RULE: 2 SURVIVORS LEFT → JACK WINS
    if (survivors.length === 2) {
      gameOver = true;
      setStatus("Game over");
      el("resultMsg").innerHTML =
        `<span class="danger">Executed.</span> ${selectedName} was NOT the Jack.<br><br>
         <span class="danger">JACK WINS!</span><br>
         Only 2 survivors remain.<br>
         (Jack was <b>${jackName}</b>)`;
      setButtons({ spin: false, execute: false, spare: false });
      return;
    }

    // CONTINUE GAME
    el("resultMsg").innerHTML =
      `<span class="danger">Executed.</span> ${selectedName} was NOT the Jack.`;

    clearRound();
    setButtons({ spin: true, execute: false, spare: false });
  });
</script>

</body>
</html>

